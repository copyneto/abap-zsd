sap.ui.define([                                                                                                                                                                                                                                                
    "sap/ui/model/Filter",                                                                                                                                                                                                                                     
    "sap/ui/model/FilterOperator",                                                                                                                                                                                                                             
    "sap/ui/comp/smartfilterbar/SmartFilterBar",                                                                                                                                                                                                               
    "sap/m/ComboBox"                                                                                                                                                                                                                                           
],                                                                                                                                                                                                                                                             
    function (Filter, FilterOperator, ComboBox) {                                                                                                                                                                                                              
        "use strict";                                                                                                                                                                                                                                          
        return sap.ui.controller("br.com.trescoracoes.zsdatualvig.ext.controller.ListReportExt", {                                                                                                                                                             
                                                                                                                                                                                                                                                               
            onInitSmartFilterBarExtension: function (oEvent) {                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                /* ===================================================================                                                                                                                                                                         
                  Monta filtro seleção                                                                                                                                                                                                                         
                  =================================================================== */                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                var today = new Date();                                                                                                                                                                                                                        
                var vData = today.toLocaleDateString()                                                                                                                                                                                                         
                var vDataFinal = vData.replace(/\//g, '.');                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                var oFilters = {                                                                                                                                                                                                                               
                    "datab": {                                                                                                                                                                                                                                 
                        "ranges": [{                                                                                                                                                                                                                           
                            "exclude": false,                                                                                                                                                                                                                  
                            "operation": "LE",                                                                                                                                                                                                                 
                            "keyField": "datab",                                                                                                                                                                                                               
                            "value1": today,                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                        }]                                                                                                                                                                                                                                     
                    },                                                                                                                                                                                                                                         
                    "datbi": {                                                                                                                                                                                                                                 
                        "ranges": [{                                                                                                                                                                                                                           
                            "exclude": false,                                                                                                                                                                                                                  
                            "operation": "GE",                                                                                                                                                                                                                 
                            "keyField": "datbi",                                                                                                                                                                                                               
                            "value1": today,                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                        }]                                                                                                                                                                                                                                     
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                };                                                                                                                                                                                                                                             
                /* ===================================================================                                                                                                                                                                         
                  Atualiza filtros de seleção                                                                                                                                                                                                                  
                  =================================================================== */                                                                                                                                                                       
                var oGlobalFilter = oEvent.getSource();                                                                                                                                                                                                        
                oGlobalFilter.setFilterData(oFilters);                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            AtualizaListaPreco: function (oEvent) {                                                                                                                                                                                                            
                /* ===================================================================                                                                                                                                                                         
                Verifica se usuário tem permissão para navegação                                                                                                                                                                                               
                =================================================================== */                                                                                                                                                                         
                sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported([                                                                                                                                                          
                    { target: { shellHash: "ZSD_ATUAL_LISTAPRECO-display" } }                                                                                                                                                                                  
                ])                                                                                                                                                                                                                                             
                    .done(function (aResponse) {                                                                                                                                                                                                               
                        aResponse.map(function (elem, index) {                                                                                                                                                                                                 
                            if (elem.supported === true) {                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                /* ===================================================================                                                                                                                                                         
                                Chama aplicativo                                                                                                                                                                                                               
                                =================================================================== */                                                                                                                                                         
                                var href_parameters = (sap.ushell && sap.ushell.Container &&                                                                                                                                                                   
                                    sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({                                                                                                                                            
                                        target: { semanticObject: "ZSD_ATUAL_LISTAPRECO", action: "display" },                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                    }));                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                                sap.m.URLHelper.redirect(href_parameters, false);                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                            else {                                                                                                                                                                                                                             
                                alert('Usuário sem permissão para acessar o link');                                                                                                                                                                            
                            }                                                                                                                                                                                                                                  
                        })                                                                                                                                                                                                                                     
                    })                                                                                                                                                                                                                                         
                    .fail(function () {                                                                                                                                                                                                                        
                        alert('Falha ao acessar o link');                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
            }                                                                                                                                                                                                                                                  
        });                                                                                                                                                                                                                                                    
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               