sap.ui.define([],                                                                                                                                                                                                                                              
    function () {                                                                                                                                                                                                                                              
        "use strict";                                                                                                                                                                                                                                          
        return sap.ui.controller("br.com.trescoracoes.cockpitdevolucao.ext.controller.ListReportExt", {                                                                                                                                                        
            onAfterRendering: function (oEvent) {                                                                                                                                                                                                              
                let oControl = this.getView().byId("addEntry");                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                let oText = this.getOwnerComponent().getModel("i18n").getResourceBundle();                                                                                                                                                                     
                oControl.setText(oText.getText("execButton"))                                                                                                                                                                                                  
            },                                                                                                                                                                                                                                                 
            gerarDevolucao: function (oEvent) {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                var oSelection = this.extensionAPI.getSelectedContexts();                                                                                                                                                                                      
                var oItemLocalNegocio = [];                                                                                                                                                                                                                    
                var oItemTipoDevolucao = [];                                                                                                                                                                                                                   
                //var oItemRegiao = oSelection[0].getObject().Regiao;                                                                                                                                                                                          
                //var oItemAno = oSelection[0].getObject().Ano;                                                                                                                                                                                                
                //var oItemMes = oSelection[0].getObject().Mes;                                                                                                                                                                                                
                //var oItemModelo = oSelection[0].getObject().Modelo;                                                                                                                                                                                          
                var oItemSerie = [];                                                                                                                                                                                                                           
                var oItemNfe = [];                                                                                                                                                                                                                             
                //var oItemDigitoVerificador = oSelection[0].getObject().DigitoVerific;                                                                                                                                                                        
                //var oItemCnpj = oSelection[0].getObject().Cnpj;                                                                                                                                                                                              
                var oOrdemDev = [];                                                                                                                                                                                                                            
                var oFormPag = [];                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                for (let i = 0; i < oSelection.length; i++) {                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                    oOrdemDev[i] = oSelection[i].getObject().SalesOrder;                                                                                                                                                                                       
                    oFormPag[i] = oSelection[i].getObject().FormaPagamento;                                                                                                                                                                                    
                    if (oOrdemDev[i] != '') {                                                                                                                                                                                                                  
                        alert('Já existe ordem de devolução para o registro selecionado.');                                                                                                                                                                    
                        return;                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                    } else if (oFormPag[i] == '') {                                                                                                                                                                                                            
                        alert('Falta preencher o meio de pagamento.');                                                                                                                                                                                         
                        return;                                                                                                                                                                                                                                
                    }                                                                                                                                                                                                                                          
                    else {                                                                                                                                                                                                                                     
                        oItemLocalNegocio[i] = oSelection[i].getObject().LocalNegocio;                                                                                                                                                                         
                        oItemTipoDevolucao[i] = oSelection[i].getObject().TipoDevolucao;                                                                                                                                                                       
                        oItemSerie[i] = oSelection[i].getObject().Serie;                                                                                                                                                                                       
                        oItemNfe[i] = oSelection[i].getObject().Nfe;                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                /* ===================================================================                                                                                                                                                                         
                Verifica se usuário tem permissão para navegação                                                                                                                                                                                               
                =================================================================== */                                                                                                                                                                         
                sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported([                                                                                                                                                          
                    //{ target: { shellHash: "devoluc_gerdev-create?LocalNegocio=" + oItemLocalNegocio + ",TipoDevolucao=" + oItemTipoDevolucao + ",Regiao=" + oItemRegiao + ",Ano=" + oItemAno + ",Mes=" + oItemMes + ",Cnpj=" + oItemCnpj +",Modelo=" + oIte+
mModelo + ",Serie=" + oItemSerie + ",NumNFe=" + oItemNfe + ",DigitoVerific=" + oItemDigitoVerificador } }                                                                                                                                                      
                    { target: { shellHash: "devoluc_gerdev-create?LocalNegocio=" + oItemLocalNegocio + ",TipoDevolucao=" + oItemTipoDevolucao + ",Serie=" + oItemSerie + ",NumNFe=" + oItemNfe } }                                                             
                ])                                                                                                                                                                                                                                             
                    .done(function (aResponse) {                                                                                                                                                                                                               
                        aResponse.map(function (elem, index) {                                                                                                                                                                                                 
                            if (elem.supported === true) {                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                /* ===================================================================                                                                                                                                                         
                                Chama outro aplicativo                                                                                                                                                                                                         
                                =================================================================== */                                                                                                                                                         
                                var href_parameters = (sap.ushell && sap.ushell.Container &&                                                                                                                                                                   
                                    sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({                                                                                                                                            
                                        target: { semanticObject: "devoluc_gerdev", action: "create" },                                                                                                                                                        
                                        params: {                                                                                                                                                                                                              
                                            LocalNegocio: oItemLocalNegocio,                                                                                                                                                                                   
                                            TipoDevolucao: oItemTipoDevolucao,                                                                                                                                                                                 
                                            //Regiao: oItemRegiao,                                                                                                                                                                                             
                                            //Ano: oItemAno,                                                                                                                                                                                                   
                                            //Mes: oItemMes,                                                                                                                                                                                                   
                                            //Cnpj: oItemCnpj,                                                                                                                                                                                                 
                                            //Modelo: oItemModelo,                                                                                                                                                                                             
                                            Serie: oItemSerie,                                                                                                                                                                                                 
                                            NumNFe: oItemNfe                                                                                                                                                                                                   
                                            //DigitoVerific: oItemDigitoVerificador                                                                                                                                                                            
                                        },                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                    }));                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                                sap.m.URLHelper.redirect(href_parameters, false);                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                            else {                                                                                                                                                                                                                             
                                alert('Usuário sem permissão para acessar o link');                                                                                                                                                                            
                            }                                                                                                                                                                                                                                  
                        })                                                                                                                                                                                                                                     
                    })                                                                                                                                                                                                                                         
                    .fail(function () {                                                                                                                                                                                                                        
                        alert('Falha ao acessar o link');                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
            ckptDevOrdem: function (oEvent) {                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                /* ===================================================================                                                                                                                                                                         
                Verifica se usuário tem permissão para navegação                                                                                                                                                                                               
                =================================================================== */                                                                                                                                                                         
                sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported([                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    { target: { shellHash: "cockpitdevordem-manage?" } }                                                                                                                                                                                       
                ])                                                                                                                                                                                                                                             
                    .done(function (aResponse) {                                                                                                                                                                                                               
                        aResponse.map(function (elem, index) {                                                                                                                                                                                                 
                            if (elem.supported === true) {                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                /* ===================================================================                                                                                                                                                         
                                Chama outro aplicativo                                                                                                                                                                                                         
                                =================================================================== */                                                                                                                                                         
                                var href_parameters = (sap.ushell && sap.ushell.Container &&                                                                                                                                                                   
                                    sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({                                                                                                                                            
                                        target: { semanticObject: "cockpitdevordem", action: "manage" },                                                                                                                                                       
                                    }));                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                                sap.m.URLHelper.redirect(href_parameters, false);                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                            else {                                                                                                                                                                                                                             
                                alert('Usuário sem permissão para acessar o link');                                                                                                                                                                            
                            }                                                                                                                                                                                                                                  
                        })                                                                                                                                                                                                                                     
                    })                                                                                                                                                                                                                                         
                    .fail(function () {                                                                                                                                                                                                                        
                        alert('Falha ao acessar o link');                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
        )                                                                                                                                                                                                                                                      
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               