sap.ui.define(["sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/ui/comp/smartfilterbar/SmartFilterBar","sap/ui/model/SimpleType","sap/ui/model/ValidateException"],function(e,a,t,r){"use strict";return sap.ui.controller("br.co+
m.trescoracoes.cockpitfaturamento.ext.controller.ListReportExt",{onInitSmartFilterBarExtension:function(e){var a=new Date;var t=a.toLocaleDateString();var r=t.replace(/\//g,".");var s=r+"-23:59:59";var l=30;var i=1e3*60*60*24;var o=new Date(a.getTime()-l+
*i);var n=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(o);var u=n.replace(/\//g,".");var c=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(a);var p=c.replace(/\//g,".");var +
d={DataLiberacao:{ranges:[{exclude:false,operation:"BT",keyField:"DataLiberacao",value1:"00.00.0000-00:00:00",value2:s}]},CreationDate:{ranges:[{exclude:false,operation:"BT",keyField:"CreationDate",value1:u,value2:p}]}};var f=e.getSource();f.setFilterDat+
a(d)},onBeforeRebindTableExtension:function(e){var a=e.getParameter("bindingParams");if(a&&a.filters&&a.filters[0]&&a.filters[0].aFilters&&a.filters.length>0){var t=a.filters[0].aFilters;var s=t.filter(e=>e.aFilters[0].sPath==="CreationDate")[0];var l=s.+
aFilters[0].oValue1;var i=s.aFilters[0].oValue2;const e=i-l;const o=e/(1e3*60*60*24);if(o>90){debugger;alert("Período selecionado ultrapassa 90 dias");r("Período selecionado ultrapassa 90 dias")}}},onConsultaDisponibilidade:function(r){var s=this.extensi+
onAPI.getSelectedContexts();var l=[];var i=[];var o=[];var n=[];var u=0;var c=0;var p=0;for(let e=0;e<s.length;e++){l[e]=s[e].getObject().SalesOrder}var d="/sap/opu/odata/SAP/ZC_SD_CKPT_FAT_FILTRO_DIP_CDS/";var f=[];var v=[];var g=new sap.ui.model.odata.+
v2.ODataModel(d,{json:true,loadMetadataAsync:true});for(let t=0;t<l.length;t++){f.push(new e("SalesDocument",a.EQ,l[t]))}v=new e({filters:f,and:false});g.read("/BuscaMaterialSet",{filters:[v],success:function(e,a){for(let a=0;a<e.results.length;a++){if(!+
i.includes(e.results[a].Material)&&e.results[a].Material!=null&&e.results[a].Material!=undefined&&e.results[a].Material!=""){i[u]=e.results[a].Material;u++}if(!o.includes(e.results[a].Plant)&&e.results[a].Plant!=null&&e.results[a].Plant!=undefined&&e.res+
ults[a].Plant!=""){o[c]=e.results[a].Plant;c++}if(!n.includes(e.results[a].StorageLocation)&&e.results[a].StorageLocation!=null&&e.results[a].StorageLocation!=undefined&&e.results[a].StorageLocation!=""){n[p]=e.results[a].StorageLocation;p++}}sap.ushell.+
Container.getService("CrossApplicationNavigation").isNavigationSupported([{target:{shellHash:"verifdisp-create"}}]).done(function(e){e.map(function(e,a){if(e.supported===true){var t=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("Cross+
ApplicationNavigation").hrefForExternal({target:{semanticObject:"verifdisp",action:"create"},params:{Material:i,Plant:o,Deposito:n}});sap.m.URLHelper.redirect(t,false)}else{alert("Usuário sem permissão para acessar o link")}})}).fail(function(){alert("Fa+
lha ao acessar o link")});sap.m.URLHelper.redirect(href_funcao,true)},error:function(e){t.show("Todos os itens estão concluídos!")}})},onEmissaoNF:function(r){var s=this.extensionAPI.getSelectedContexts();var l=[];var i=[];var o=[];var n=[];var u=[];var +
c=0;var p=0;var d=0;var f=0;for(let e=0;e<s.length;e++){l[e]=s[e].getObject().SalesOrder}var v="/sap/opu/odata/SAP/ZC_SD_CKPT_FAT_FILTRO_ARM_CDS/";var g=[];var m=[];var h=new sap.ui.model.odata.v2.ODataModel(v,{json:true,loadMetadataAsync:true});for(let +
t=0;t<l.length;t++){g.push(new e("SalesDocument",a.EQ,l[t]))}m=new e({filters:g,and:false});h.read("/BuscaMaterialSet",{filters:[m],success:function(e,a){for(let a=0;a<e.results.length;a++){if(!i.includes(e.results[a].Material)&&e.results[a].Material!=nu+
ll&&e.results[a].Material!=undefined&&e.results[a].Material!=""){i[c]=e.results[a].Material;c++}if(!o.includes(e.results[a].Plant)&&e.results[a].Plant!=null&&e.results[a].Plant!=undefined&&e.results[a].Plant!=""){o[p]=e.results[a].Plant;p++}if(!n.include+
s(e.results[a].centrofaturamento)&&e.results[a].centrofaturamento!=null&&e.results[a].centrofaturamento!=undefined&&e.results[a].centrofaturamento!=""){n[d]=e.results[a].centrofaturamento;d++}if(!u.includes(e.results[a].StorageLocation)&&e.results[a].Sto+
rageLocation!=null&&e.results[a].StorageLocation!=undefined&&e.results[a].StorageLocation!=""){u[f]=e.results[a].StorageLocation;f++}}sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported([{target:{shellHash:"retArmaz-manage+
"}}]).done(function(e){e.map(function(e,a){if(e.supported===true){var t=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({target:{semanticObject:"retArmaz",action:"manage"},params:{EANType:"0+
0",Material:i,CentroDestino:o,CentroOrigem:n,DepositoDestino:u,DepositoOrigem:u}});sap.m.URLHelper.redirect(t,false)}else{alert("Usuário sem permissão para acessar o link")}})}).fail(function(){alert("Falha ao acessar o link")});sap.m.URLHelper.redirect(+
href_funcao,true)},error:function(e){t.show("Todos os itens estão concluídos!")}})},onRecusarOrdem:function(e){var a=this.extensionAPI.getSelectedContexts();var t=[];var r=[];var s=[];for(let e=0;e<a.length;e++){if(a[e].getObject().StatusDeliveryBlockRea+
son=="Pendente"){sap.m.MessageToast.show("Impossível recusar, pedido sem liberação comercial");return}t[e]=a[e].getObject().SalesOrder;r[e]=a[e].getObject().Plant;s[e]=a[e].getObject().SalesOrganization}sap.ushell.Container.getService("CrossApplicationNa+
vigation").isNavigationSupported([{target:{shellHash:"sdmotivorecitem-change"}}]).done(function(e){e.map(function(e,a){if(e.supported===true){var l=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExt+
ernal({target:{semanticObject:"sdmotivorecitem",action:"change"},params:{SalesOrder:t,Plant:r,SalesOrganization:s}});sap.m.URLHelper.redirect(l,false)}else{alert("Usuário sem permissão para acessar o link")}})}).fail(function(){alert("Falha ao acessar o +
link")});sap.m.URLHelper.redirect(href_funcao,true)}})});                                                                                                                                                                                                      