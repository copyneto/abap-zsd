sap.ui.define([],                                                                                                                                                                                                                                              
function (){                                                                                                                                                                                                                                                   
    "use strict";                                                                                                                                                                                                                                              
    return sap.ui.controller("br.com.trescoracoes.verifutil.ext.controller.ListReportExt", {                                                                                                                                                                   
        SubstituirProduto: function(oEvent) {                                                                                                                                                                                                                  
            /* ===================================================================                                                                                                                                                                             
            Monta uma tabela com as linhas selecionadas                                                                                                                                                                                                        
            =================================================================== */                                                                                                                                                                             
            var oSelection = this.extensionAPI.getSelectedContexts();                                                                                                                                                                                          
            var oSalesOrder = [];                                                                                                                                                                                                                              
            var oSalesOrderItem = [];                                                                                                                                                                                                                          
            var oProduto = [];                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            for (let i = 0; i < oSelection.length; i++) {                                                                                                                                                                                                      
                oSalesOrder[i] = oSelection[i].getObject().SalesOrder;                                                                                                                                                                                         
                oSalesOrderItem[i] = oSelection[i].getObject().SalesOrderItem;                                                                                                                                                                                 
                oProduto[i] = oSelection[i].getObject().Material;                                                                                                                                                                                              
            }                                                                                                                                                                                                                                                  
            /* ===================================================================                                                                                                                                                                             
            Verifica se usuário tem permissão para navegação                                                                                                                                                                                                   
            =================================================================== */                                                                                                                                                                             
            sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported([                                                                                                                                                              
                { target: { shellHash: "subsprod-display" } }                                                                                                                                                                                                  
            ])                                                                                                                                                                                                                                                 
                .done(function (aResponse) {                                                                                                                                                                                                                   
                    aResponse.map(function (elem, index) {                                                                                                                                                                                                     
                        if (elem.supported === true) {                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                            /* ===================================================================                                                                                                                                                             
                            Chama outro aplicativo                                                                                                                                                                                                             
                            =================================================================== */                                                                                                                                                             
                            var href_parameters = (sap.ushell && sap.ushell.Container &&                                                                                                                                                                       
                                sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({                                                                                                                                                
                                    target: { semanticObject: "subsprod", action: "display" },                                                                                                                                                                 
                                    params: { SalesOrder: oSalesOrder , SalesOrderItem: oSalesOrderItem, MaterialAtual: oProduto },                                                                                                                            
                                }));                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                            sap.m.URLHelper.redirect(href_parameters, false);                                                                                                                                                                                  
                        }                                                                                                                                                                                                                                      
                        else {                                                                                                                                                                                                                                 
                            alert('Usuário sem permissão para acessar o link');                                                                                                                                                                                
                        }                                                                                                                                                                                                                                      
                    })                                                                                                                                                                                                                                         
                })                                                                                                                                                                                                                                             
                .fail(function () {                                                                                                                                                                                                                            
                    alert('Falha ao acessar o link');                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            sap.m.URLHelper.redirect(href_funcao, true);                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
        }                                                                                                                                                                                                                                                      
    });                                                                                                                                                                                                                                                        
});                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               