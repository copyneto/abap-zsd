sap.ui.define(["sap/m/PDFViewer", "sap/suite/ui/generic/template/ObjectPage/extensionAPI/ExtensionAPI" ],                                                                                                                                                      
function (PDFViewer, extensionAPI){                                                                                                                                                                                                                            
    "use strict";                                                                                                                                                                                                                                              
    return {                                                                                                                                                                                                                                                   
        downloadFormColetaAvaria: function(oEvent) {                                                                                                                                                                                                           
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Recupa referência à tabela do relatório                                                                                                                                                                                                        
                =================================================================== */                                                                                                                                                                         
                //var oItems = sap.ui.getCore().byId(this.oView.sId + '--responsiveTable'  ).getSelectedItems();                                                                                                                                               
                //var oItems = extensionAPI.getSelectedContexts();                                                                                                                                                                                             
                let oItems = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                               
                //var oItems = sap.ui.getCore().byId( this.oView.sId + '--GridTable'  ).getSelectedItems();                                                                                                                                                    
                //var oItems = oEvent.getSource().getParent().getParent().getTable().getSelectedItems();                                                                                                                                                       
                //var oItems = sap.ui.getCore().byId(this.oView.sId + '--GridTable-sapUiTableGridCont').getSelectedItems();                                                                                                                                    
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria Diálogo dinâmico (pop-up)                                                                                                                                                                                                                 
                =================================================================== */                                                                                                                                                                         
                var oUploadDialog = new sap.m.Dialog({                                                                                                                                                                                                         
                    contentWidth: "300px",                                                                                                                                                                                                                     
                    resizable: true,                                                                                                                                                                                                                           
                    type: "Message"                                                                                                                                                                                                                            
                });                                                                                                                                                                                                                                            
                oUploadDialog.setTitle("Download");                                                                                                                                                                                                            
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Texto do Pop-up                                                                                                                                                                                                                                
                =================================================================== */                                                                                                                                                                         
                if( oItems.length == 1 ){                                                                                                                                                                                                                      
                    var oText = new sap.m.Text({ text: "Deseja imprimir os formulário selecionado?" });                                                                                                                                                        
                }else{                                                                                                                                                                                                                                         
                    var oText = new sap.m.Text({ text: "Deseja imprimir os formulários dos " + oItems.length + " documentos selecionados?" });                                                                                                                 
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria botão de cancelar                                                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                var oCancelButton = new sap.m.Button({                                                                                                                                                                                                         
                    text: 'Cancelar',                                                                                                                                                                                                                          
                    type: 'Reject',                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    press: function () {                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        oUploadDialog.close();                                                                                                                                                                                                                 
                        oUploadDialog.destroy();                                                                                                                                                                                                               
                        this.getView().removeAllDependents();                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                    }.bind(this)                                                                                                                                                                                                                               
                });&nbsp;                                                                                                                                                                                                                                      
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria botão para a carga do arquivo                                                                                                                                                                                                             
                =================================================================== */                                                                                                                                                                         
                var oDownloadButton = new sap.m.Button({                                                                                                                                                                                                       
                    text: 'Aceitar',                                                                                                                                                                                                                           
                    type: 'Accept',                                                                                                                                                                                                                            
                    press: function () {                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        oUploadDialog.close();                                                                                                                                                                                                                 
                        oUploadDialog.destroy();                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        var oServiceUrl = "/sap/opu/odata/SAP/ZSD_DOWNLOAD_COLETA_AVARIA_SRV/";                                                                                                                                                                
                        var oModel = new sap.ui.model.odata.ODataModel(oServiceUrl, false);                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        /* ===================================================================&nbsp;                                                                                                                                                           
                        Recupera PDFs das linhas selecionadas                                                                                                                                                                                                  
                        =================================================================== */                                                                                                                                                                 
                        for (let i = 0; i < oItems.length; i++) {                                                                                                                                                                                              
                            //var oObject = oItems[i].getBindingContext().getObject();                                                                                                                                                                         
                            var oObject = oItems[i].getObject();                                                                                                                                                                                               
                            var oSource = oServiceUrl + "downloadSet(SalesOrder='" + oObject.SalesOrder + "')/$value";                                                                                                                                         
                            var oPDFViewer = new PDFViewer();                                                                                                                                                                                                  
                            this.getView().addDependent(oPDFViewer);                                                                                                                                                                                           
                            oPDFViewer.setSource(oSource);                                                                                                                                                                                                     
                            oPDFViewer.downloadPDF();                                                                                                                                                                                                          
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    }.bind(this)                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama diálogo com a lógica de carga&nbsp;                                                                                                                                                                                                      
                =================================================================== */                                                                                                                                                                         
                oUploadDialog.addContent(oText);                                                                                                                                                                                                               
                oUploadDialog.setBeginButton(oCancelButton);                                                                                                                                                                                                   
                oUploadDialog.setEndButton(oDownloadButton);                                                                                                                                                                                                   
                oUploadDialog.open();                                                                                                                                                                                                                          
          // alert('downloadFormColetaAvaria');                                                                                                                                                                                                                
        }                                                                                                                                                                                                                                                      
    };                                                                                                                                                                                                                                                         
});                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               