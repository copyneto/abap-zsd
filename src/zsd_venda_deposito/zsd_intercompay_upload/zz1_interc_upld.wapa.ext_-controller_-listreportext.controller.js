sap.ui.define(["sap/m/library","sap/ui/export/Spreadsheet","sap/ui/export/library","sap/m/Dialog","sap/m/MessageView","sap/m/Bar","sap/m/Button","sap/m/Text","sap/ui/core/IconPool","sap/m/MessageItem","sap/ui/model/json/JSONModel","br/com/trescoracoes/in+
tercompany/upload/ext/controller/jszip","br/com/trescoracoes/intercompany/upload/ext/controller/xlsx"],function(e,t,a,o,r,s,i,n,l,p,c,u,g){"use strict";var d;var m;var y;var h;var f;var M;var D;var T;var b;var v;var x;var S;return{onInit:function(e){d=th+
is;m=this.getOwnerComponent();y=this.getOwnerComponent().getModel("i18n").getResourceBundle();M=new i({icon:l.getIconURI("nav-back"),visible:false,press:function(){h.navigateBack();M.setVisible(false)}});var t=new p({type:"{type}",title:"{message}",activ+
eTitle:"{active}",description:"{description}",subtitle:"{subtitle}",counter:"{counter}",groupName:"{group}"});h=new r({showDetailsPageHeader:false,itemSelect:function(){M.setVisible(true)},items:{path:"/",template:t},groupItems:true});f=new o({title:"Men+
sagens de retorno",resizable:true,content:h,state:"Error",customHeader:new s({contentMiddle:[new n({text:"Mensagens de retorno"})],contentLeft:[M],contentRight:[new i({press:function(){f.close()},icon:l.getIconURI("decline"),type:"Reject"})]}),contentHei+
ght:"50%",contentWidth:"28%",verticalScrolling:false})},onGenerateModel:function(e){var a=[];a.push({label:"Processo",property:"Processo",type:sap.ui.model.type.String});a.push({label:"TipoDeOperacao",property:"TipoDeOperacao",type:sap.ui.model.type.Stri+
ng});a.push({label:"CentroOrigem",property:"CentroOrigem",type:sap.ui.model.type.String});a.push({label:"DepositoOrigem",property:"DepositoOrigem",type:sap.ui.model.type.String});a.push({label:"CentroDestino",property:"CentroDestino",type:sap.ui.model.ty+
pe.String});a.push({label:"DepositoDestino",property:"DepositoDestino",type:sap.ui.model.type.String});a.push({label:"CentroReceptor",property:"CentroReceptor",type:sap.ui.model.type.String});a.push({label:"Incoterms",property:"Incoterms",type:sap.ui.mod+
el.type.Integer});a.push({label:"TipoExpedicao",property:"TipoExpedicao",type:sap.ui.model.type.String});a.push({label:"CondicaoExpedicao",property:"CondicaoExpedicao",type:sap.ui.model.type.String});a.push({label:"AgenteFrete",property:"AgenteFrete",typ+
e:sap.ui.model.type.String});a.push({label:"Motorista",property:"Motorista",type:sap.ui.model.type.String});a.push({label:"Placa",property:"Placa",type:sap.ui.model.type.String});a.push({label:"PlacaSemiReboque1",property:"PlacaSemiReboque1",type:sap.ui.+
model.type.String});a.push({label:"PlacaSemiReboque2",property:"PlacaSemiReboque2",type:sap.ui.model.type.String});a.push({label:"PlacaSemiReboque3",property:"PlacaSemiReboque3",type:sap.ui.model.type.String});a.push({label:"ID3Cargo",property:"ID3Cargo"+
,type:sap.ui.model.type.String});a.push({label:"OrganizacaoDeCompras",property:"OrganizacaoDeCompras",type:sap.ui.model.type.String});a.push({label:"GrupoDeCompradores",property:"GrupoDeCompradores",type:sap.ui.model.type.String});a.push({label:"RemessaD+
eTransferenciaDevolucao",property:"RemessaDeTransferenciaDevolucao",type:sap.ui.model.type.String});a.push({label:"UtilizacaoGraoVerde",property:"UtilizacaoGraoVerde",type:sap.ui.model.type.String});a.push({label:"Fracionado",property:"Fracionado",type:s+
ap.ui.model.type.String});a.push({label:"Material",property:"Material",type:sap.ui.model.type.String});a.push({label:"UnidadeBase",property:"UnidadeBase",type:sap.ui.model.type.String});a.push({label:"Quantidade",property:"Quantidade",type:sap.ui.model.t+
ype.Float});var o={workbook:{columns:a},dataSource:[""],count:1,fileName:"PedidoIntercompanyExcel.xlsx"};var r=new t(o);r.build().finally(function(){r.destroy()})},onUploadExcel:function(e){if(b==null){b=new o({contentWidth:"300px",resizable:true,type:"M+
essage"});var t=e.getSource().getParent().getParent();T=new sap.ui.unified.FileUploader({width:"100%",fileType:["xlsx"],typeMissmatch:this.handleTypeMissmatch});v=new sap.m.Button({text:"Carregar",type:"Accept",press:function(e){b.setBusy(true);T.checkFi+
leReadable().then(function(){var e=T.FUEl;var a=e.files[0];if(T.getValue()===""){sap.m.MessageToast.show(y.getText("inforSelectArquive"));b.setBusy(false);return}x.setEnabled(false);d.ExecuteReadExcel(e.files&&e.files[0],m.getModel(),t)},function(e){d.ha+
ndlerError(y.getText("errorReaderExcel"))}).then(function(){T.clear()})}});x=new sap.m.Button({icon:l.getIconURI("decline"),type:"Reject",press:function(){b.close()}});try{var a=false;var r=h.getModel().oData.length;if(r!=0){a=true}}catch(e){}D=new i({ic+
on:l.getIconURI("message-error"),type:"Negative",text:r,visible:a,press:function(){h.navigateBack();M.setVisible(false);f.open()}});b.addContent(T);b.addButton(D);b.addButton(v);b.setCustomHeader(new s({contentMiddle:[new n({text:y.getText("dialogUpload"+
)})],contentRight:[x]}));b.open()}else{b.open()}},handleTypeMissmatch:function(e){var t=e.getSource().getFileType();jQuery.each(t,function(e,a){t[e]="*."+a});var a=t.join(", ");sap.m.MessageToast.show("Tipo de arquivo *."+e.getParameter("fileType")+" não+
 é suportado. Escolha um dos tipos a seguir: "+a)},ExecuteReadExcel:function(e,t,a){var o={};var r=true;if(e&&window.FileReader){if(S==null){S=new FileReader}S.onload=function(e){var t=e.target.result;var a=XLSX.read(t,{type:"binary"});a.SheetNames.forEa+
ch(function(e){o=XLSX.utils.sheet_to_row_object_array(a.Sheets[e])})};S.onloadend=function(s){if(r){if(!d.validateFields(o)){return}sap.m.MessageToast.show(y.getText("inforInProcess"));d.ExecuteActionValidationSave(o,e,t,a)}};S.onerror=function(e){r=fals+
e;d.handlerError(y.getText("errorReaderExcel"))};S.readAsBinaryString(e)}else{d.handlerError(y.getText("errorPageReader"))}},validateFields:function(e){try{if(e.length==0){throw new UserException("ArquiveInvalid")}e.forEach(e=>{e.Processo=e.Processo==nul+
l?"":e.Processo;e.TipoDeOperacao=e.TipoDeOperacao==null?"":e.TipoDeOperacao;e.CentroOrigem=e.CentroOrigem==null?"":e.CentroOrigem;e.DepositoOrigem=e.DepositoOrigem==null?"":e.DepositoOrigem;e.CentroDestino=e.CentroDestino==null?"":e.CentroDestino;e.Depos+
itoDestino=e.DepositoDestino==null?"":e.DepositoDestino;e.CentroReceptor=e.CentroReceptor==null?"":e.CentroReceptor;e.Incoterms=e.Incoterms==null?"":e.Incoterms;e.TipoExpedicao=e.TipoExpedicao==null?"":e.TipoExpedicao;e.CondicaoExpedicao=e.CondicaoExpedi+
cao==null?"":e.CondicaoExpedicao;e.AgenteFrete=e.AgenteFrete==null?"":e.AgenteFrete;e.Motorista=e.Motorista==null?"":e.Motorista;e.Placa=e.Placa==null?"":e.Placa;e.PlacaSemiReboque1=e.PlacaSemiReboque1==null?"":e.PlacaSemiReboque1;e.PlacaSemiReboque2=e.P+
lacaSemiReboque2==null?"":e.PlacaSemiReboque2;e.PlacaSemiReboque3=e.PlacaSemiReboque3==null?"":e.PlacaSemiReboque3;e.ID3Cargo=e.ID3Cargo==null?"":e.ID3Cargo;e.OrganizacaoDeCompras=e.OrganizacaoDeCompras==null?"":e.OrganizacaoDeCompras;e.GrupoDeCompradore+
s=e.GrupoDeCompradores==null?"":e.GrupoDeCompradores;e.RemessaDeTransferenciaDevolucao=e.RemessaDeTransferenciaDevolucao==null?"":e.RemessaDeTransferenciaDevolucao;e.UtilizacaoGraoVerde=e.UtilizacaoGraoVerde==null?"":e.UtilizacaoGraoVerde;e.Fracionado=e.+
Fracionado==null?"":e.Fracionado;e.Material=e.Material==null?"":e.Material;e.UnidadeBase=e.UnidadeBase==null?"":e.UnidadeBase;e.Quantidade=e.Quantidade==null?0:e.Quantidade})}catch(t){if(e.length==0){d.handlerError(y.getText("errorArquiveInitial"))}else{+
d.handlerError(y.getText("errorLayoutIncorrect"))}return false}return true},ExecuteActionValidationSave:function(e,t,a,o){var r=e.length;var s=0;try{sap.ui.getCore().getMessageManager().removeAllMessages()}catch(e){}try{e.forEach(r=>{a.callFunction("/toV+
alidateSave",{method:"POST",urlParameters:{Guid:"00000000-0000-0000-0000-000000000000",FileDirectory:t.name,Processo:r.Processo,TipoOperacao:r.TipoDeOperacao,CentroOrigem:r.CentroOrigem,DepositoOrigem:r.DepositoOrigem,CentroDestino:r.CentroDestino,Deposi+
toDestino:r.DepositoDestino,CentroReceptor:r.CentroReceptor,Incoterms:r.Incoterms,TipoExpedicao:r.TipoExpedicao,CondicaoExpedicao:r.CondicaoExpedicao,AgenteFrete:r.AgenteFrete,Motorista:r.Motorista,Placa:r.Placa,PlacaSemiReboque1:r.PlacaSemiReboque1,Plac+
aSemiReboque2:r.PlacaSemiReboque2,PlacaSemiReboque3:r.PlacaSemiReboque3,ID3Cargo:r.ID3Cargo,OrganizacaoCompras:r.OrganizacaoDeCompras,GrupoCompradores:r.GrupoDeCompradores,RemessaTranferenciaDevolucao:r.RemessaDeTransferenciaDevolucao,UtilizacaoGraoVerde+
:r.UtilizacaoGraoVerde,Fracionado:r.Fracionado,Material:r.Material,UnidadeBase:r.UnidadeBase,Quantidade:r.Quantidade},success:function(r,i){s+=+1;d.successActionValidationSave(s,e,t,a,o)}.bind(this),error:function(e){s+=+1;d.errorActionValidationSave(e,s+
)}.bind(this),refreshAfterChange:true})})}catch(e){d.handlerError(y.getText("errorToProcessAction"))}},successActionValidationSave:function(e,t,a,o,r){if(e==1){try{let e=sap.ui.getCore().getMessageManager().getMessageModel().getData()[0];d.ExecuteActionP+
rocess(t,a,o,r,e.message)}catch(e){d.handlerError(y.getText("errorToGetReturn"))}}},errorActionValidationSave:function(e,t){if(t==1){try{var a=new c;a.setData(sap.ui.getCore().getMessageManager().getMessageModel().getData());h.setModel(a);D.setText(sap.u+
i.getCore().getMessageManager().getMessageModel().getData().length);try{var o=JSON.parse(e.responseText);if(o.error.code=="005056A509B11EE1B9A8DBD9EA7BB778"){let e=[];e.push({message:y.getText("errorModelExcel"),type:"Error"});a.setData(e);h.setModel(a);+
D.setText("1")}}catch(e){}try{if(sap.ui.getCore().getMessageManager().getMessageModel().getData().length==0){let e=[];e.push({message:y.getText("errorToReceiveReturnVS"),type:"Error"});e.push({message:y.getText("inforSuport"),type:"Information"});let t=n+
ew c;t.setData(e);h.setModel(t);D.setText("1")}}catch(e){}D.setIcon(l.getIconURI("message-error"));D.setType("Negative");D.setVisible(true);h.navigateBack();M.setVisible(false);f.open()}catch(e){sap.m.MessageToast.show(y.getText("errorToGetMessageReturn"+
))}try{b.setBusy(false);x.setEnabled(true)}catch(e){}}},ExecuteActionProcess:function(e,t,a,o,r){var s=e.length;var i=0;try{sap.ui.getCore().getMessageManager().removeAllMessages()}catch(e){}var n=e[0];try{a.callFunction("/toProcess",{method:"POST",urlPa+
rameters:{Guid:r},success:function(e,t){i+=+1;d.successActionProcess(s,i,o)}.bind(this),error:function(e){i+=+1;d.errorActionProcess(e,i)}.bind(this),refreshAfterChange:true})}catch(e){d.handlerError(y.getText("errorToGetReturnProcess"))}},successActionP+
rocess:function(e,t,a){try{var o=new c;o.setData(sap.ui.getCore().getMessageManager().getMessageModel().getData());h.setModel(o);D.setText(sap.ui.getCore().getMessageManager().getMessageModel().getData().length);if(sap.ui.getCore().getMessageManager().ge+
tMessageModel().getData().length==0){let e=[];e.push({message:y.getText("successWithoutMessage"),type:"Success"});o.setData(e);h.setModel(o);D.setText("1")}D.setIcon(l.getIconURI("message-success"));D.setType("Success");D.setVisible(true);h.navigateBack(+
);M.setVisible(false);f.open()}catch(e){D.setVisible(false);sap.m.MessageToast.show(y.getText("inforReturn"))}try{b.setBusy(false);x.setEnabled(true);b.close()}catch(e){d.handlerError(y.getText("errorDialog"))}try{if(a){a.getModel().refresh(true)}}catch(+
e){}},errorActionProcess:function(e,t){if(t==1){try{var a=new c;a.setData(sap.ui.getCore().getMessageManager().getMessageModel().getData());h.setModel(a);D.setText(sap.ui.getCore().getMessageManager().getMessageModel().getData().length);try{var o=JSON.pa+
rse(e.responseText);if(o.error.code=="005056A509B11EE1B9A8DBD9EA7BB778"){let e=[];e.push({message:y.getText("errorModelExcel"),type:"Error"});a.setData(e);h.setModel(a);D.setText("1")}}catch(e){}try{if(sap.ui.getCore().getMessageManager().getMessageModel+
().getData().length==0){let e=[];e.push({message:y.getText("errorToReceiveReturn"),type:"Error"});e.push({message:y.getText("inforSuport"),type:"Information"});let t=new c;t.setData(e);h.setModel(t);D.setText("1")}}catch(e){}D.setIcon(l.getIconURI("messa+
ge-error"));D.setType("Negative");D.setVisible(true);h.navigateBack();M.setVisible(false);f.open()}catch(e){sap.m.MessageToast.show(y.getText("errorToGetMessageReturn"));D.setVisible(false)}try{b.setBusy(false);x.setEnabled(true)}catch(e){d.handlerError(+
y.getText("errorDialog"))}}},handlerError:function(e){let t=[];t.push({message:e,type:"Error"});var a=new c;a.setData(t);h.setModel(a);D.setText("1");D.setIcon(l.getIconURI("message-error"));D.setType("Negative");D.setVisible(true);h.navigateBack();M.set+
Visible(false);f.open();b.setBusy(false);x.setEnabled(true)},onCockpitDocument:function(e){let t=this.templateBaseExtension.getExtensionAPI().getSelectedContexts();sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported([{targ+
et:{shellHash:"coligados-manage"}}]).done(function(e){e.map(function(e,a){if(e.supported===true){var o=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({target:{semanticObject:"coligados",act+
ion:"manage"},params:{Guid:t[0].getObject().Guid}});sap.m.URLHelper.redirect(o,true)}else{sap.m.MessageToast.show(y.getText("errorToPermission"))}})}).fail(function(){sap.m.MessageToast.show(y.getText("errotoAccessLink"))})}}});                           