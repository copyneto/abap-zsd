sap.ui.define([                                                                                                                                                                                                                                                
    "sap/m/library",                                                                                                                                                                                                                                           
    "sap/ui/export/Spreadsheet",                                                                                                                                                                                                                               
    "sap/ui/export/library",                                                                                                                                                                                                                                   
    "sap/m/Dialog",                                                                                                                                                                                                                                            
    "sap/m/MessageView",                                                                                                                                                                                                                                       
    "sap/m/Bar",                                                                                                                                                                                                                                               
    "sap/m/Button",                                                                                                                                                                                                                                            
    "sap/m/Text",                                                                                                                                                                                                                                              
    "sap/ui/core/IconPool",                                                                                                                                                                                                                                    
    "sap/m/MessageItem",                                                                                                                                                                                                                                       
    "sap/ui/model/json/JSONModel",                                                                                                                                                                                                                             
    //bibliotecas necessárias para leitura do excel                                                                                                                                                                                                            
    "br/com/trescoracoes/intercompany/upload/ext/controller/jszip",                                                                                                                                                                                            
    "br/com/trescoracoes/intercompany/upload/ext/controller/xlsx"],                                                                                                                                                                                            
    function (MobileLibrary, spreadsheet, library, Dialog, MessageView, Bar, Button, Text, IconPool, MessageItem, JSONModel, jszip, xlsx) {                                                                                                                    
        "use strict";                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
        //Variáveis de contexto                                                                                                                                                                                                                                
        var oThisContext;                                                                                                                                                                                                                                      
        var oViewComponent;                                                                                                                                                                                                                                    
        var oI18n;                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
        //Variáveis de Mensagens de retorno                                                                                                                                                                                                                    
        var oMessageView;                                                                                                                                                                                                                                      
        var oMessageDialog;                                                                                                                                                                                                                                    
        var oBackButtonMessage;                                                                                                                                                                                                                                
        var oBtnMessages;                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
        //Variáveis de diálogo upload                                                                                                                                                                                                                          
        var oFileUploader;                                                                                                                                                                                                                                     
        var oUploadDialog;                                                                                                                                                                                                                                     
        var oBtnUpload;                                                                                                                                                                                                                                        
        var oBtnClose;                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
        //Variáveis da leitura excel                                                                                                                                                                                                                           
        var oReaderExcel;                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
        return {                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            onInit: function (oEvent) {                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                //Contexto                                                                                                                                                                                                                                     
                oThisContext = this;                                                                                                                                                                                                                           
                oViewComponent = this.getOwnerComponent();// ou this.getView();                                                                                                                                                                                
                oI18n = this.getOwnerComponent().getModel("i18n").getResourceBundle();                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                //Montagem dos objetos principais                                                                                                                                                                                                              
                oBackButtonMessage = new Button({                                                                                                                                                                                                              
                    icon: IconPool.getIconURI("nav-back"),                                                                                                                                                                                                     
                    visible: false,                                                                                                                                                                                                                            
                    press: function () {                                                                                                                                                                                                                       
                        oMessageView.navigateBack();                                                                                                                                                                                                           
                        oBackButtonMessage.setVisible(false);                                                                                                                                                                                                  
                    }                                                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                var oMessageTemplate = new MessageItem({                                                                                                                                                                                                       
                    type: '{type}',                                                                                                                                                                                                                            
                    title: '{message}',                                                                                                                                                                                                                        
                    activeTitle: "{active}",                                                                                                                                                                                                                   
                    description: '{description}',                                                                                                                                                                                                              
                    subtitle: '{subtitle}',                                                                                                                                                                                                                    
                    counter: '{counter}',                                                                                                                                                                                                                      
                    groupName: '{group}'                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                oMessageView = new MessageView({                                                                                                                                                                                                               
                    showDetailsPageHeader: false,                                                                                                                                                                                                              
                    itemSelect: function () {                                                                                                                                                                                                                  
                        oBackButtonMessage.setVisible(true);                                                                                                                                                                                                   
                    },                                                                                                                                                                                                                                         
                    items: {                                                                                                                                                                                                                                   
                        path: "/",                                                                                                                                                                                                                             
                        template: oMessageTemplate                                                                                                                                                                                                             
                    },                                                                                                                                                                                                                                         
                    groupItems: true                                                                                                                                                                                                                           
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                oMessageDialog = new Dialog({                                                                                                                                                                                                                  
                    title: "Mensagens de retorno",                                                                                                                                                                                                             
                    resizable: true,                                                                                                                                                                                                                           
                    content: oMessageView,                                                                                                                                                                                                                     
                    state: 'Error',                                                                                                                                                                                                                            
                    customHeader: new Bar({                                                                                                                                                                                                                    
                        contentMiddle: [                                                                                                                                                                                                                       
                            new Text({ text: "Mensagens de retorno" })                                                                                                                                                                                         
                        ],                                                                                                                                                                                                                                     
                        contentLeft: [                                                                                                                                                                                                                         
                            oBackButtonMessage                                                                                                                                                                                                                 
                        ],                                                                                                                                                                                                                                     
                        contentRight: [                                                                                                                                                                                                                        
                            new Button({                                                                                                                                                                                                                       
                                press: function () {                                                                                                                                                                                                           
                                    oMessageDialog.close();                                                                                                                                                                                                    
                                },                                                                                                                                                                                                                             
                                icon: IconPool.getIconURI("decline"),                                                                                                                                                                                          
                                type: 'Reject'                                                                                                                                                                                                                 
                            })                                                                                                                                                                                                                                 
                        ]                                                                                                                                                                                                                                      
                    }),                                                                                                                                                                                                                                        
                    contentHeight: "50%",                                                                                                                                                                                                                      
                    contentWidth: "28%",                                                                                                                                                                                                                       
                    verticalScrolling: false                                                                                                                                                                                                                   
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onGenerateModel: function (oEvent) {                                                                                                                                                                                                               
                //Monta layout de colunas                                                                                                                                                                                                                      
                var aCols = [];                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Processo',                                                                                                                                                                                                                         
                    property: 'Processo',                                                                                                                                                                                                                      
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'TipoDeOperacao',                                                                                                                                                                                                                   
                    property: 'TipoDeOperacao',                                                                                                                                                                                                                
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'CentroOrigem',                                                                                                                                                                                                                     
                    property: 'CentroOrigem',                                                                                                                                                                                                                  
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'DepositoOrigem',                                                                                                                                                                                                                   
                    property: 'DepositoOrigem',                                                                                                                                                                                                                
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'CentroDestino',                                                                                                                                                                                                                    
                    property: 'CentroDestino',                                                                                                                                                                                                                 
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'DepositoDestino',                                                                                                                                                                                                                  
                    property: 'DepositoDestino',                                                                                                                                                                                                               
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'CentroReceptor',                                                                                                                                                                                                                   
                    property: 'CentroReceptor',                                                                                                                                                                                                                
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Incoterms',                                                                                                                                                                                                                        
                    property: 'Incoterms',                                                                                                                                                                                                                     
                    type: sap.ui.model.type.Integer                                                                                                                                                                                                            
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'TipoExpedicao',                                                                                                                                                                                                                    
                    property: 'TipoExpedicao',                                                                                                                                                                                                                 
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'CondicaoExpedicao',                                                                                                                                                                                                                
                    property: 'CondicaoExpedicao',                                                                                                                                                                                                             
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'AgenteFrete',                                                                                                                                                                                                                      
                    property: 'AgenteFrete',                                                                                                                                                                                                                   
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Motorista',                                                                                                                                                                                                                        
                    property: 'Motorista',                                                                                                                                                                                                                     
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Placa',                                                                                                                                                                                                                            
                    property: 'Placa',                                                                                                                                                                                                                         
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'PlacaSemiReboque1',                                                                                                                                                                                                                
                    property: 'PlacaSemiReboque1',                                                                                                                                                                                                             
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'PlacaSemiReboque2',                                                                                                                                                                                                                
                    property: 'PlacaSemiReboque2',                                                                                                                                                                                                             
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'PlacaSemiReboque3',                                                                                                                                                                                                                
                    property: 'PlacaSemiReboque3',                                                                                                                                                                                                             
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'ID3Cargo',                                                                                                                                                                                                                         
                    property: 'ID3Cargo',                                                                                                                                                                                                                      
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'OrganizacaoDeCompras',                                                                                                                                                                                                             
                    property: 'OrganizacaoDeCompras',                                                                                                                                                                                                          
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'GrupoDeCompradores',                                                                                                                                                                                                               
                    property: 'GrupoDeCompradores',                                                                                                                                                                                                            
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'RemessaDeTransferenciaDevolucao',                                                                                                                                                                                                  
                    property: 'RemessaDeTransferenciaDevolucao',                                                                                                                                                                                               
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'UtilizacaoGraoVerde',                                                                                                                                                                                                              
                    property: 'UtilizacaoGraoVerde',                                                                                                                                                                                                           
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Fracionado',                                                                                                                                                                                                                       
                    property: 'Fracionado',                                                                                                                                                                                                                    
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Material',                                                                                                                                                                                                                         
                    property: 'Material',                                                                                                                                                                                                                      
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'UnidadeBase',                                                                                                                                                                                                                      
                    property: 'UnidadeBase',                                                                                                                                                                                                                   
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Quantidade',                                                                                                                                                                                                                       
                    property: 'Quantidade',                                                                                                                                                                                                                    
                    type: sap.ui.model.type.Float                                                                                                                                                                                                              
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                //Prepara configurações                                                                                                                                                                                                                        
                var oSettings = {                                                                                                                                                                                                                              
                    workbook: { columns: aCols },                                                                                                                                                                                                              
                    dataSource: [''],                                                                                                                                                                                                                          
                    count: 1,                                                                                                                                                                                                                                  
                    fileName: 'PedidoIntercompanyExcel.xlsx'                                                                                                                                                                                                   
                };                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                //Cria planilha&nbsp;                                                                                                                                                                                                                          
                var oSheet = new spreadsheet(oSettings);                                                                                                                                                                                                       
                oSheet.build().finally(function () {                                                                                                                                                                                                           
                    oSheet.destroy();                                                                                                                                                                                                                          
                })                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onUploadExcel: function (oEvent) {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                if (oUploadDialog == null) {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    //Cria Diálogo dinâmico (pop-up)                                                                                                                                                                                                           
                    oUploadDialog = new Dialog({                                                                                                                                                                                                               
                        contentWidth: "300px",                                                                                                                                                                                                                 
                        resizable: true,                                                                                                                                                                                                                       
                        type: "Message"                                                                                                                                                                                                                        
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    // Tabela do listreport                                                                                                                                                                                                                    
                    var oTable = oEvent.getSource().getParent().getParent();                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    //Prepara o responsável pela carga do arquivo                                                                                                                                                                                              
                    oFileUploader = new sap.ui.unified.FileUploader({                                                                                                                                                                                          
                        width: "100%",                                                                                                                                                                                                                         
                        fileType: ["xlsx"],                                                                                                                                                                                                                    
                        typeMissmatch: this.handleTypeMissmatch                                                                                                                                                                                                
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    //Cria botão para a carga do arquivo                                                                                                                                                                                                       
                    oBtnUpload = new sap.m.Button({                                                                                                                                                                                                            
                        text: 'Carregar',                                                                                                                                                                                                                      
                        type: 'Accept',                                                                                                                                                                                                                        
                        press: function (event) {                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            // Inativar tela - esperando                                                                                                                                                                                                       
                            oUploadDialog.setBusy(true);                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                            oFileUploader.checkFileReadable().then(function () {                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                // Verifica se arquivo foi informado                                                                                                                                                                                           
                                var domRef = oFileUploader.FUEl;                                                                                                                                                                                               
                                var file = domRef.files[0];                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                                if (oFileUploader.getValue() === '') {                                                                                                                                                                                         
                                    sap.m.MessageToast.show(oI18n.getText("inforSelectArquive"));                                                                                                                                                              
                                    oUploadDialog.setBusy(false);                                                                                                                                                                                              
                                    return;                                                                                                                                                                                                                    
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                //Bloqueio botão de fechamento do diálogo                                                                                                                                                                                      
                                oBtnClose.setEnabled(false);                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                oThisContext.ExecuteReadExcel(domRef.files && domRef.files[0], oViewComponent.getModel(), oTable);                                                                                                                             
                                                                                                                                                                                                                                                               
                            }, function (error) {                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                oThisContext.handlerError(oI18n.getText("errorReaderExcel"))                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            }).then(function () {                                                                                                                                                                                                              
                                oFileUploader.clear();                                                                                                                                                                                                         
                            });                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    //Cria botão de fechar                                                                                                                                                                                                                     
                    oBtnClose = new sap.m.Button({                                                                                                                                                                                                             
                        icon: IconPool.getIconURI("decline"),                                                                                                                                                                                                  
                        type: 'Reject',                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                        press: function () {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            oUploadDialog.close();                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    try {                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        var vVisible = false;                                                                                                                                                                                                                  
                        var vText = oMessageView.getModel().oData.length;                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        if (vText != 0) {                                                                                                                                                                                                                      
                            vVisible = true;                                                                                                                                                                                                                   
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    } catch (error) {                                                                                                                                                                                                                          
                        //Não exibir                                                                                                                                                                                                                           
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    oBtnMessages = new Button({                                                                                                                                                                                                                
                        icon: IconPool.getIconURI("message-error"),                                                                                                                                                                                            
                        type: "Negative",                                                                                                                                                                                                                      
                        text: vText,                                                                                                                                                                                                                           
                        visible: vVisible,                                                                                                                                                                                                                     
                        press: function () {                                                                                                                                                                                                                   
                            oMessageView.navigateBack();                                                                                                                                                                                                       
                            oBackButtonMessage.setVisible(false);                                                                                                                                                                                              
                            oMessageDialog.open();                                                                                                                                                                                                             
                        }                                                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    //Chama diálogo com a lógica de carga&nbsp;                                                                                                                                                                                                
                    oUploadDialog.addContent(oFileUploader);                                                                                                                                                                                                   
                    oUploadDialog.addButton(oBtnMessages);                                                                                                                                                                                                     
                    oUploadDialog.addButton(oBtnUpload);                                                                                                                                                                                                       
                    oUploadDialog.setCustomHeader(new Bar({                                                                                                                                                                                                    
                        contentMiddle: [                                                                                                                                                                                                                       
                            new Text({ text: oI18n.getText("dialogUpload") })                                                                                                                                                                                  
                        ],                                                                                                                                                                                                                                     
                        contentRight: [oBtnClose]                                                                                                                                                                                                              
                    }));                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    oUploadDialog.open();                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                } else {                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    oUploadDialog.open();                                                                                                                                                                                                                      
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            handleTypeMissmatch: function (oEvent) {                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                var aFileTypes = oEvent.getSource().getFileType();                                                                                                                                                                                             
                jQuery.each(aFileTypes, function (key, value) { aFileTypes[key] = "*." + value; });                                                                                                                                                            
                var sSupportedFileTypes = aFileTypes.join(", ");                                                                                                                                                                                               
                sap.m.MessageToast.show("Tipo de arquivo *." + oEvent.getParameter("fileType") +                                                                                                                                                               
                    " não é suportado. Escolha um dos tipos a seguir: " +                                                                                                                                                                                      
                    sSupportedFileTypes);                                                                                                                                                                                                                      
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            ExecuteReadExcel: function (file, oModel, oTable) {                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                var excelData = {};                                                                                                                                                                                                                            
                var Success = true;                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                if (file && window.FileReader) {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    if (oReaderExcel == null) {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        oReaderExcel = new FileReader();                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    oReaderExcel.onload = function (e) {                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        var data = e.target.result;                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                        var workbook = XLSX.read(data, {                                                                                                                                                                                                       
                            type: 'binary'                                                                                                                                                                                                                     
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        workbook.SheetNames.forEach(function (sheetName) {                                                                                                                                                                                     
                            // Passagem da linha para o array                                                                                                                                                                                                  
                            excelData = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    };                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    oReaderExcel.onloadend = function (e) {                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        if (Success) {                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                            //Validação/Preenchimento de campo com vazio para não gerar erro na passagem dos dados                                                                                                                                             
                            if (!oThisContext.validateFields(excelData)) {                                                                                                                                                                                     
                                return;                                                                                                                                                                                                                        
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            sap.m.MessageToast.show(oI18n.getText("inforInProcess"));                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                            //Executa chamadas da ação com os dados                                                                                                                                                                                            
                            oThisContext.ExecuteActionValidationSave(excelData, file, oModel, oTable);                                                                                                                                                         
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    };                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    oReaderExcel.onerror = function (ex) {                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        Success = false;                                                                                                                                                                                                                       
                        oThisContext.handlerError(oI18n.getText("errorReaderExcel"));                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    };                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    oReaderExcel.readAsBinaryString(file);                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                } else {                                                                                                                                                                                                                                       
                    //Implementar mensagem de erro                                                                                                                                                                                                             
                    oThisContext.handlerError(oI18n.getText("errorPageReader"));                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            validateFields: function (excelData) {                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                try {                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    if (excelData.length == 0) {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        throw new UserException("ArquiveInvalid");                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    excelData.forEach(e => {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                        //"Preeche" campo para evitar erro na chamada, validação será feita no backend                                                                                                                                                         
                        e.Processo = ((e.Processo == null) ? '' : e.Processo);                                                                                                                                                                                 
                        e.TipoDeOperacao = ((e.TipoDeOperacao == null) ? '' : e.TipoDeOperacao);                                                                                                                                                               
                        e.CentroOrigem = ((e.CentroOrigem == null) ? '' : e.CentroOrigem);                                                                                                                                                                     
                        e.DepositoOrigem = ((e.DepositoOrigem == null) ? '' : e.DepositoOrigem);                                                                                                                                                               
                        e.CentroDestino = ((e.CentroDestino == null) ? '' : e.CentroDestino);                                                                                                                                                                  
                        e.DepositoDestino = ((e.DepositoDestino == null) ? '' : e.DepositoDestino);                                                                                                                                                            
                        e.CentroReceptor = ((e.CentroReceptor == null) ? '' : e.CentroReceptor);                                                                                                                                                               
                        e.Incoterms = ((e.Incoterms == null) ? '' : e.Incoterms);                                                                                                                                                                              
                        e.TipoExpedicao = ((e.TipoExpedicao == null) ? '' : e.TipoExpedicao);                                                                                                                                                                  
                        e.CondicaoExpedicao = ((e.CondicaoExpedicao == null) ? '' : e.CondicaoExpedicao);                                                                                                                                                      
                        e.AgenteFrete = ((e.AgenteFrete == null) ? '' : e.AgenteFrete);                                                                                                                                                                        
                        e.Motorista = ((e.Motorista == null) ? '' : e.Motorista);                                                                                                                                                                              
                        e.Placa = ((e.Placa == null) ? '' : e.Placa);                                                                                                                                                                                          
                        e.PlacaSemiReboque1 = ((e.PlacaSemiReboque1 == null) ? '' : e.PlacaSemiReboque1);                                                                                                                                                      
                        e.PlacaSemiReboque2 = ((e.PlacaSemiReboque2 == null) ? '' : e.PlacaSemiReboque2);                                                                                                                                                      
                        e.PlacaSemiReboque3 = ((e.PlacaSemiReboque3 == null) ? '' : e.PlacaSemiReboque3);                                                                                                                                                      
                        e.ID3Cargo = ((e.ID3Cargo == null) ? '' : e.ID3Cargo);                                                                                                                                                                                 
                        e.OrganizacaoDeCompras = ((e.OrganizacaoDeCompras == null) ? '' : e.OrganizacaoDeCompras);                                                                                                                                             
                        e.GrupoDeCompradores = ((e.GrupoDeCompradores == null) ? '' : e.GrupoDeCompradores);                                                                                                                                                   
                        e.RemessaDeTransferenciaDevolucao = ((e.RemessaDeTransferenciaDevolucao == null) ? '' : e.RemessaDeTransferenciaDevolucao);                                                                                                            
                        e.UtilizacaoGraoVerde = ((e.UtilizacaoGraoVerde == null) ? '' : e.UtilizacaoGraoVerde);                                                                                                                                                
                        e.Fracionado = ((e.Fracionado == null) ? '' : e.Fracionado);                                                                                                                                                                           
                        e.Material = ((e.Material == null) ? '' : e.Material);                                                                                                                                                                                 
                        e.UnidadeBase = ((e.UnidadeBase == null) ? '' : e.UnidadeBase);                                                                                                                                                                        
                        e.Quantidade = ((e.Quantidade == null) ? 0 : e.Quantidade);                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                } catch (error) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    if (excelData.length == 0) {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        oThisContext.handlerError(oI18n.getText("errorArquiveInitial"));                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    } else {                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                        oThisContext.handlerError(oI18n.getText("errorLayoutIncorrect"));                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    return false;                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                return true;                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            ExecuteActionValidationSave: function (excelData, file, oModel, oTable) {                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                //Quantidade de linhas                                                                                                                                                                                                                         
                var vQuantity = excelData.length;                                                                                                                                                                                                              
                var vCount = 0;                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                // Remove mensagens do processo                                                                                                                                                                                                                
                try {                                                                                                                                                                                                                                          
                    sap.ui.getCore().getMessageManager().removeAllMessages();                                                                                                                                                                                  
                } catch (error) { }                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                try {                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    excelData.forEach(e => {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                        oModel.callFunction("/toValidateSave",                                                                                                                                                                                                 
                            {                                                                                                                                                                                                                                  
                                method: "POST",                                                                                                                                                                                                                
                                urlParameters: {                                                                                                                                                                                                               
                                    "Guid": '00000000-0000-0000-0000-000000000000',                                                                                                                                                                            
                                    "FileDirectory": file.name,                                                                                                                                                                                                
                                    "Processo": e.Processo,                                                                                                                                                                                                    
                                    "TipoOperacao": e.TipoDeOperacao,                                                                                                                                                                                          
                                    "CentroOrigem": e.CentroOrigem,                                                                                                                                                                                            
                                    "DepositoOrigem": e.DepositoOrigem,                                                                                                                                                                                        
                                    "CentroDestino": e.CentroDestino,                                                                                                                                                                                          
                                    "DepositoDestino": e.DepositoDestino,                                                                                                                                                                                      
                                    "CentroReceptor": e.CentroReceptor,                                                                                                                                                                                        
                                    "Incoterms": e.Incoterms,                                                                                                                                                                                                  
                                    "TipoExpedicao": e.TipoExpedicao,                                                                                                                                                                                          
                                    "CondicaoExpedicao": e.CondicaoExpedicao,                                                                                                                                                                                  
                                    "AgenteFrete": e.AgenteFrete,                                                                                                                                                                                              
                                    "Motorista": e.Motorista,                                                                                                                                                                                                  
                                    "Placa": e.Placa,                                                                                                                                                                                                          
                                    "PlacaSemiReboque1": e.PlacaSemiReboque1,                                                                                                                                                                                  
                                    "PlacaSemiReboque2": e.PlacaSemiReboque2,                                                                                                                                                                                  
                                    "PlacaSemiReboque3": e.PlacaSemiReboque3,                                                                                                                                                                                  
                                    "ID3Cargo": e.ID3Cargo,                                                                                                                                                                                                    
                                    "OrganizacaoCompras": e.OrganizacaoDeCompras,                                                                                                                                                                              
                                    "GrupoCompradores": e.GrupoDeCompradores,                                                                                                                                                                                  
                                    "RemessaTranferenciaDevolucao": e.RemessaDeTransferenciaDevolucao,                                                                                                                                                         
                                    "UtilizacaoGraoVerde": e.UtilizacaoGraoVerde,                                                                                                                                                                              
                                    "Fracionado": e.Fracionado,                                                                                                                                                                                                
                                    "Material": e.Material,                                                                                                                                                                                                    
                                    "UnidadeBase": e.UnidadeBase,                                                                                                                                                                                              
                                    "Quantidade": e.Quantidade                                                                                                                                                                                                 
                                },                                                                                                                                                                                                                             
                                success: function (oData, response) {                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                    vCount += + 1;                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                    oThisContext.successActionValidationSave(vCount, excelData, file, oModel, oTable);                                                                                                                                         
                                                                                                                                                                                                                                                               
                                }.bind(this),                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                                error: function (oError) {                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                    vCount += + 1;                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                    oThisContext.errorActionValidationSave(oError, vCount);                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                                }.bind(this),                                                                                                                                                                                                                  
                                refreshAfterChange: true                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                            });                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                } catch (error) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    oThisContext.handlerError(oI18n.getText("errorToProcessAction"));                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            successActionValidationSave: function (vCount, excelData, file, oModel, oTable) {                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                if (vCount == 1) {                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    try {                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        //Pega primeiro registro com a mensagem do guid criado                                                                                                                                                                                 
                        let sMessage = sap.ui.getCore().getMessageManager().getMessageModel().getData()[0];                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        oThisContext.ExecuteActionProcess(excelData, file, oModel, oTable, sMessage.message);                                                                                                                                                  
                                                                                                                                                                                                                                                               
                    } catch (error) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                        oThisContext.handlerError(oI18n.getText("errorToGetReturn"));                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            errorActionValidationSave: function (oError, vCount) {                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                if (vCount == 1) {                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    try {                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        var oModelMessageManager = new JSONModel();                                                                                                                                                                                            
                        oModelMessageManager.setData(sap.ui.getCore().getMessageManager().getMessageModel().getData());                                                                                                                                        
                        oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                        oBtnMessages.setText(sap.ui.getCore().getMessageManager().getMessageModel().getData().length);                                                                                                                                         
                                                                                                                                                                                                                                                               
                        try {                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            var rMessage = JSON.parse(oError.responseText);                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                            if (rMessage.error.code == "005056A509B11EE1B9A8DBD9EA7BB778") {                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                let sMessage = [];                                                                                                                                                                                                             
                                sMessage.push({                                                                                                                                                                                                                
                                    message: oI18n.getText("errorModelExcel"),                                                                                                                                                                                 
                                    type: "Error"                                                                                                                                                                                                              
                                });                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                oModelMessageManager.setData(sMessage);                                                                                                                                                                                        
                                oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                oBtnMessages.setText("1");                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        } catch (error) { }                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        try {                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            if (sap.ui.getCore().getMessageManager().getMessageModel().getData().length == 0) {                                                                                                                                                
                                                                                                                                                                                                                                                               
                                let sMessage = [];                                                                                                                                                                                                             
                                sMessage.push({                                                                                                                                                                                                                
                                    message: oI18n.getText("errorToReceiveReturnVS"),                                                                                                                                                                          
                                    type: "Error"                                                                                                                                                                                                              
                                });                                                                                                                                                                                                                            
                                sMessage.push({                                                                                                                                                                                                                
                                    message: oI18n.getText("inforSuport"),                                                                                                                                                                                     
                                    type: "Information"                                                                                                                                                                                                        
                                });                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                let oModelMessageManager = new JSONModel();                                                                                                                                                                                    
                                oModelMessageManager.setData(sMessage);                                                                                                                                                                                        
                                oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                oBtnMessages.setText("1");                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        } catch (error) { }                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        oBtnMessages.setIcon(IconPool.getIconURI("message-error"));                                                                                                                                                                            
                        oBtnMessages.setType("Negative");                                                                                                                                                                                                      
                        oBtnMessages.setVisible(true);                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                        oMessageView.navigateBack();                                                                                                                                                                                                           
                        oBackButtonMessage.setVisible(false);                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        oMessageDialog.open();                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    } catch (error) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                        sap.m.MessageToast.show(oI18n.getText("errorToGetMessageReturn"));                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    try {                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        oUploadDialog.setBusy(false);                                                                                                                                                                                                          
                        oBtnClose.setEnabled(true);                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    } catch (error) { }                                                                                                                                                                                                                        
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            ExecuteActionProcess: function (excelData, file, oModel, oTable, Guid) {                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                //Após leitura do arquivo realiza validações e execução da action                                                                                                                                                                              
                var vQuantity = excelData.length;                                                                                                                                                                                                              
                var vCount = 0;                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                // Remove mensagens do processo                                                                                                                                                                                                                
                try {                                                                                                                                                                                                                                          
                    sap.ui.getCore().getMessageManager().removeAllMessages();                                                                                                                                                                                  
                } catch (error) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                var sData = excelData[0];                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                try {                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    oModel.callFunction("/toProcess",                                                                                                                                                                                                          
                        {                                                                                                                                                                                                                                      
                            method: "POST",                                                                                                                                                                                                                    
                            urlParameters: {                                                                                                                                                                                                                   
                                "Guid": Guid                                                                                                                                                                                                                   
                            },                                                                                                                                                                                                                                 
                            success: function (oData, response) {                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                vCount += + 1;                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                oThisContext.successActionProcess(vQuantity, vCount, oTable);                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                            error: function (oError) {                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                vCount += + 1;                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                oThisContext.errorActionProcess(oError, vCount);                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                            refreshAfterChange: true                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                } catch (error) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    oThisContext.handlerError(oI18n.getText("errorToGetReturnProcess"));                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            successActionProcess: function (vQuantity, vCount, oTable) {                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                try {                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    //Dados de mensagens retornadas do backend                                                                                                                                                                                                 
                    var oModelMessageManager = new JSONModel();                                                                                                                                                                                                
                    oModelMessageManager.setData(sap.ui.getCore().getMessageManager().getMessageModel().getData());                                                                                                                                            
                    oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    oBtnMessages.setText(sap.ui.getCore().getMessageManager().getMessageModel().getData().length);                                                                                                                                             
                                                                                                                                                                                                                                                               
                    if (sap.ui.getCore().getMessageManager().getMessageModel().getData().length == 0) {                                                                                                                                                        
                                                                                                                                                                                                                                                               
                        let sMessage = [];                                                                                                                                                                                                                     
                        sMessage.push({                                                                                                                                                                                                                        
                            message: oI18n.getText("successWithoutMessage"),                                                                                                                                                                                   
                            type: "Success"                                                                                                                                                                                                                    
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        oModelMessageManager.setData(sMessage);                                                                                                                                                                                                
                        oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                        oBtnMessages.setText("1");                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    oBtnMessages.setIcon(IconPool.getIconURI("message-success"));                                                                                                                                                                              
                    oBtnMessages.setType("Success");                                                                                                                                                                                                           
                    oBtnMessages.setVisible(true);                                                                                                                                                                                                             
                    oMessageView.navigateBack();                                                                                                                                                                                                               
                    oBackButtonMessage.setVisible(false);                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    oMessageDialog.open();                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                } catch (error) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    oBtnMessages.setVisible(false);                                                                                                                                                                                                            
                    sap.m.MessageToast.show(oI18n.getText("inforReturn"));                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                try {                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    oUploadDialog.setBusy(false);                                                                                                                                                                                                              
                    oBtnClose.setEnabled(true);                                                                                                                                                                                                                
                    oUploadDialog.close();                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                } catch (error) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    oThisContext.handlerError(oI18n.getText("errorDialog"));                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                try {                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    if (oTable) {                                                                                                                                                                                                                              
                        oTable.getModel().refresh(true);                                                                                                                                                                                                       
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                } catch (error) { }                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
            errorActionProcess: function (oError, vCount) {                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                if (vCount == 1) {                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    try {                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        var oModelMessageManager = new JSONModel();                                                                                                                                                                                            
                        oModelMessageManager.setData(sap.ui.getCore().getMessageManager().getMessageModel().getData());                                                                                                                                        
                        oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                        oBtnMessages.setText(sap.ui.getCore().getMessageManager().getMessageModel().getData().length);                                                                                                                                         
                                                                                                                                                                                                                                                               
                        try {                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            var rMessage = JSON.parse(oError.responseText);                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                            if (rMessage.error.code == "005056A509B11EE1B9A8DBD9EA7BB778") {                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                let sMessage = [];                                                                                                                                                                                                             
                                sMessage.push({                                                                                                                                                                                                                
                                    message: oI18n.getText("errorModelExcel"),                                                                                                                                                                                 
                                    type: "Error"                                                                                                                                                                                                              
                                });                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                oModelMessageManager.setData(sMessage);                                                                                                                                                                                        
                                oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                oBtnMessages.setText("1");                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        } catch (error) { }                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        try {                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            if (sap.ui.getCore().getMessageManager().getMessageModel().getData().length == 0) {                                                                                                                                                
                                                                                                                                                                                                                                                               
                                let sMessage = [];                                                                                                                                                                                                             
                                sMessage.push({                                                                                                                                                                                                                
                                    message: oI18n.getText("errorToReceiveReturn"),                                                                                                                                                                            
                                    type: "Error"                                                                                                                                                                                                              
                                });                                                                                                                                                                                                                            
                                sMessage.push({                                                                                                                                                                                                                
                                    message: oI18n.getText("inforSuport"),                                                                                                                                                                                     
                                    type: "Information"                                                                                                                                                                                                        
                                });                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                let oModelMessageManager = new JSONModel();                                                                                                                                                                                    
                                oModelMessageManager.setData(sMessage);                                                                                                                                                                                        
                                oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                oBtnMessages.setText("1");                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        } catch (error) { }                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        oBtnMessages.setIcon(IconPool.getIconURI("message-error"));                                                                                                                                                                            
                        oBtnMessages.setType("Negative");                                                                                                                                                                                                      
                        oBtnMessages.setVisible(true);                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                        oMessageView.navigateBack();                                                                                                                                                                                                           
                        oBackButtonMessage.setVisible(false);                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        oMessageDialog.open();                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    } catch (error) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                        sap.m.MessageToast.show(oI18n.getText("errorToGetMessageReturn"));                                                                                                                                                                     
                        oBtnMessages.setVisible(false);                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    try {                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        oUploadDialog.setBusy(false);                                                                                                                                                                                                          
                        oBtnClose.setEnabled(true);                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    } catch (error) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                        oThisContext.handlerError(oI18n.getText("errorDialog"));                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
            handlerError: function (vMessage) {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                let sMessage = [];                                                                                                                                                                                                                             
                sMessage.push({                                                                                                                                                                                                                                
                    message: vMessage,                                                                                                                                                                                                                         
                    type: "Error"                                                                                                                                                                                                                              
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                var oModelMessageManager = new JSONModel();                                                                                                                                                                                                    
                oModelMessageManager.setData(sMessage);                                                                                                                                                                                                        
                oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                oBtnMessages.setText("1");                                                                                                                                                                                                                     
                oBtnMessages.setIcon(IconPool.getIconURI("message-error"));                                                                                                                                                                                    
                oBtnMessages.setType("Negative");                                                                                                                                                                                                              
                oBtnMessages.setVisible(true);                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                oMessageView.navigateBack();                                                                                                                                                                                                                   
                oBackButtonMessage.setVisible(false);                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                oMessageDialog.open();                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                oUploadDialog.setBusy(false);                                                                                                                                                                                                                  
                oBtnClose.setEnabled(true);                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
            onCockpitDocument: function (oEvent) {                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                //----Recupera tabela do relatório                                                                                                                                                                                                             
                let oItems = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                               
                                                                                                                                                                                                                                                               
                //----Verifica permissão de navegação                                                                                                                                                                                                          
                sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported([                                                                                                                                                          
                    { target: { shellHash: "coligados-manage" } }])                                                                                                                                                                                            
                    .done(function (aResponse) {                                                                                                                                                                                                               
                        aResponse.map(function (elem, index) {                                                                                                                                                                                                 
                            if (elem.supported === true) {                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                //----Chama aplicativo intertercompany                                                                                                                                                                                         
                                var href_parameters = (sap.ushell && sap.ushell.Container &&                                                                                                                                                                   
                                    sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({                                                                                                                                            
                                        target: { semanticObject: "coligados", action: "manage" },                                                                                                                                                             
                                        params: {                                                                                                                                                                                                              
                                            Guid: oItems[0].getObject().Guid                                                                                                                                                                                   
                                        }                                                                                                                                                                                                                      
                                    }));                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                                sap.m.URLHelper.redirect(href_parameters, true);                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                            else {                                                                                                                                                                                                                             
                                sap.m.MessageToast.show(oI18n.getText("errorToPermission"));                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                        })                                                                                                                                                                                                                                     
                    })                                                                                                                                                                                                                                         
                    .fail(function () {                                                                                                                                                                                                                        
                        sap.m.MessageToast.show(oI18n.getText("errotoAccessLink"));                                                                                                                                                                            
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
            }                                                                                                                                                                                                                                                  
        };                                                                                                                                                                                                                                                     
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               